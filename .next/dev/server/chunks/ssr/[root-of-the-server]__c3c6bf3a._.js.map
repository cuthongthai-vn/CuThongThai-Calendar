{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///Users/bachpham/Documents/CuThongThai_Calendar/app/macro/page.js"],"sourcesContent":["\nimport { createClient } from '@supabase/supabase-js';\nimport MacroChart from '@/components/MacroChart';\n\nexport const revalidate = 3600; // Revalidate every hour\n\nconst supabase = createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL,\n    process.env.SUPABASE_SERVICE_ROLE_KEY\n);\n\n// Helper to pivot data: { '2024-01-01': { date: '...', USD: 25000, ... } }\nconst pivotData = (rows) => {\n    const map = {};\n    rows.forEach(r => {\n        // Normalize date to YYYY-MM-DD\n        const dateStr = r.date.split('T')[0];\n        if (!map[dateStr]) map[dateStr] = { date: dateStr };\n\n        // Map indicator keys to simplified props\n        if (r.indicator_key === 'USDVND_OFFICIAL') map[dateStr].official = Number(r.value);\n        if (r.indicator_key === 'USDVND_BLACK_MARKET') map[dateStr].black_market = Number(r.value);\n        if (r.indicator_key === 'VN_GDP_YOY') map[dateStr].gdp = Number(r.value);\n        if (r.indicator_key === 'VN_CPI_YOY') map[dateStr].cpi = Number(r.value);\n        if (r.indicator_key === 'VN_INTEREST_RATE') map[dateStr].ref_rate = Number(r.value);\n        if (r.indicator_key === 'VN_SAVINGS_RATE_12M') map[dateStr].savings_rate = Number(r.value);\n    });\n    // Convert to sorted array\n    return Object.values(map).sort((a, b) => new Date(a.date) - new Date(b.date));\n};\n\nexport default async function MacroPage() {\n    // Fetch all macro data\n    const { data: rawData, error } = await supabase\n        .from('macro_indicators')\n        .select('*')\n        .order('date', { ascending: true });\n\n    if (error) {\n        return <div className=\"text-red-500 p-10\">Error loading data: {error.message}</div>;\n    }\n\n    const chartData = pivotData(rawData);\n\n    // Filter subsets for specific charts\n\n    // 1. Forex: Filter out days where NO forex data exists at all to keep chart clean\n    // (Though re-charts handles nulls, too many gaps looks bad. But let's show all for continuity)\n    const forexData = chartData.filter(d => d.official || d.black_market).slice(-365 * 2); // Last 2 years\n\n    // 2. GDP & CPI (Quarterly/Monthly)\n    // Filter to only rows that have either GDP or CPI\n    const econData = chartData.filter(d => d.gdp !== undefined || d.cpi !== undefined);\n\n    // 3. Interest Rates\n    const ratesData = chartData.filter(d => d.ref_rate !== undefined || d.savings_rate !== undefined);\n\n\n    return (\n        <div className=\"min-h-screen bg-slate-950 p-6 md:p-10\">\n            <header className=\"mb-10\">\n                <h1 className=\"text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-600 mb-2\">\n                    VĨ MÔ VIỆT NAM\n                </h1>\n                <p className=\"text-slate-400\">\n                    Bức tranh sức khỏe nền kinh tế qua các con số biết nói.\n                </p>\n            </header>\n\n            <div className=\"grid grid-cols-1 gap-8 max-w-7xl mx-auto\">\n\n                {/* SECTION 1: EXCHANGE RATE */}\n                <section>\n                    <div className=\"flex items-center justify-between mb-4\">\n                        <h2 className=\"text-xl font-bold text-white flex items-center\">\n                            <span className=\"bg-green-500 w-1 h-6 mr-3 rounded-full\"></span>\n                            Tỷ Giá USD/VND\n                        </h2>\n                        <span className=\"text-xs font-mono text-slate-500 bg-slate-900 px-2 py-1 rounded\">Last 2 Years</span>\n                    </div>\n                    <MacroChart\n                        data={forexData}\n                        dataKeys={[\n                            { key: 'black_market', color: '#fbbf24', name: 'Chợ Đen' },\n                            { key: 'official', color: '#3b82f6', name: 'Ngân Hàng' }\n                        ]}\n                        height={400}\n                    />\n                    <div className=\"text-xs text-slate-500 mt-2 text-right\">** Nguồn: FMP & TygiaUSD.org</div>\n                </section>\n\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n\n                    {/* SECTION 2: INTEREST RATES */}\n                    <section>\n                        <div className=\"flex items-center justify-between mb-4\">\n                            <h2 className=\"text-xl font-bold text-white flex items-center\">\n                                <span className=\"bg-purple-500 w-1 h-6 mr-3 rounded-full\"></span>\n                                Lãi Suất (%)\n                            </h2>\n                        </div>\n                        <MacroChart\n                            data={ratesData}\n                            dataKeys={[\n                                { key: 'ref_rate', color: '#a855f7', name: 'Điều hành (SBV)' },\n                                { key: 'savings_rate', color: '#ec4899', name: 'Tiết kiệm 12T' }\n                            ]}\n                        />\n                    </section>\n\n                    {/* SECTION 3: GDP & INFLATION */}\n                    <section>\n                        <div className=\"flex items-center justify-between mb-4\">\n                            <h2 className=\"text-xl font-bold text-white flex items-center\">\n                                <span className=\"bg-cyan-500 w-1 h-6 mr-3 rounded-full\"></span>\n                                Tăng Trưởng & Lạm Phát (%)\n                            </h2>\n                        </div>\n                        <MacroChart\n                            data={econData}\n                            dataKeys={[\n                                { key: 'gdp', color: '#06b6d4', name: 'GDP (YoY)' },\n                                { key: 'cpi', color: '#f97316', name: 'CPI (Lạm phát)' }\n                            ]}\n                        />\n                    </section>\n                </div>\n\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}